<html>
<head>
  <title>Data Import</title>
  <link rel="stylesheet" href="dataImport.css">
</head>
<body>
  <img id="spinner" src="data:image/gif;base64,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" data-bind="visible: spinnerCount() > 0">
  <div id="user-info" data-bind="text: userInfo"></div>
  <div class="area">
    <h1>Input data</h1>
    <label><span>Format:</span> <select data-bind="value: dataFormat"><option value="excel">Excel<option value="csv">CSV</select></label>
    <label><span>Action:</span> <select data-bind="value: importAction"><option value="create">Insert<option value="update">Update<option value="upsert">Upsert<option value="delete">Delete</select></label>
    <label><span>Object:</span> <input type="text" data-bind="value: importType" list="sobjectlist"></label>
    <label title="Used in upserts to determine if an existing record should be updated or a new record should be created" data-bind="visible: importAction() == 'upsert'"><span>External ID:</span> <input type="text" data-bind="value: externalId" list="idlookuplist"></label>
    <label title="The number of records per batch. A higher value is faster but increases the risk of errors due to governor limits."><span>Batch size:</span> <input type="number" data-bind="value: batchSize" class="batch-size"></label>
    <label title="The number of batches to execute concurrently. A higher number is faster but increases the risk of errors due to lock congestion."><span>Threads:</span> <input type="number" data-bind="value: batchConcurrency" class="batch-size"></label>
    <datalist id="sobjectlist" data-bind="foreach: sobjectList"><option data-bind="attr: {value: $data}"></datalist>
    <datalist id="idlookuplist" data-bind="foreach: idLookupList()"><option data-bind="attr: {value: $data}"></datalist>
    <datalist id="columnlist" data-bind="foreach: columnList()"><option data-bind="attr: {value: $data}"></datalist>
    <a href="about:blank" id="import-help-btn" data-bind="click: toggleHelp">Import help</a>
    <textarea id="data" data-bind="style: {maxHeight: (winInnerHeight() - 200) + 'px'}"></textarea>
    <a href="about:blank" class="char-btn" data-bind="click: showDescribe" title="Show field info for the selected object">i</a>
    <label>
      <span>Available columns:</span> <input type="text" list="columnlist">
    </label>
    <div data-bind="visible: showHelp">
      <p>Use for quick one-off data imports. Support is currently limited and may destroy your data.</p>
      <ul>
        <li>Enter your CSV or Excel data in the box above.
          <ul>
            <li>The input must contain a header row with field API names.</li>
            <li>To use an external ID for a lookup field, the header row should contain the lookup relation name, the target sobject name and the external ID name separated by colons, e.g. "MyLookupField__r:MyObject__c:MyExternalIdField__c".</li>
            <li>Empty cells insert null values.</li>
            <li>Number, date, time and checkbox values must conform to the relevant <a href="http://www.w3.org/TR/xmlschema-2/#built-in-primitive-datatypes" target="_blank">XSD datatypes</a>.</li>
            <li>Columns starting with an underscore are ignored.</li>
            <li>You can use the result of an import to retry failed records. If the input contains a "__Status" column, records marked as "Succeeded" will not be imported.</li>
          </ul>
        </li>
        <li>Select your input format</li>
        <li>Select an action (insert, update, upsert or delete)</li>
        <li>Enter the API name of the object to import</li>
        <li>Press Import</li>
      </ul>
      <p>Bulk API is not supported. Large data volumes may freeze or crash your browser.</p>
    </div>
  </div>
  <div class="action-arrow">
    <div class="arrow-body"><button data-bind="click: doImport, disable: activeBatches() > 0">Import</button><div style="color:white;font-weight:bold;font-size:1.4em;margin-top:.3em;text-shadow:2px 2px 3px red">BETA!</div></div>
    <div class="arrow-head"></div>
  </div>
  <div class="area">
    <h1>Import result</h1>
    <label><input type=radio name="data-format" value="excel" data-bind="checked: dataResultFormat"> <span>Excel</span></label>
    <label><input type=radio name="data-format" value="csv" data-bind="checked: dataResultFormat"> <span>CSV</span></label>
    <button class="cancel-btn" data-bind="visible: importResult().counts.Queued > 0, click: stopImport">Stop</button>
    <div>
      <span>Status:</span>
      <label data-bind="css: {statusGroupEmpty: importResult().counts.Queued == 0}"><input type=checkbox data-bind="checked: showStatus.Queued"> <span data-bind="text: importResult().counts.Queued"></span> <span>Queued</span></label>
      <label data-bind="css: {statusGroupEmpty: importResult().counts.Processing == 0}"><input type=checkbox data-bind="checked: showStatus.Processing"> <span data-bind="text: importResult().counts.Processing"></span> <span>Processing</span></label>
      <label data-bind="css: {statusGroupEmpty: importResult().counts.Succeeded == 0}"><input type=checkbox data-bind="checked: showStatus.Succeeded"> <span data-bind="text: importResult().counts.Succeeded"></span> <span>Succeeded</span></label>
      <label data-bind="css: {statusGroupEmpty: importResult().counts.Failed == 0}"><input type=checkbox data-bind="checked: showStatus.Failed"> <span data-bind="text: importResult().counts.Failed"></span> <span>Failed</span></label>
      <label data-bind="css: {statusGroupEmpty: importResult().counts.Canceled == 0}"><input type=checkbox data-bind="checked: showStatus.Canceled"> <span data-bind="text: importResult().counts.Canceled"></span> <span>Canceled</span></label>
    </div>
    <div data-bind="if: importResult().hasMore">
      <span data-bind="text: importResult().hasMore"></span>
      <a href="about:blank" data-bind="click: showMore">Show more</a>
    </div>
    <div id="result-box" data-bind="style: {height: (winInnerHeight() - resultBoxOffsetTop() - 25) + 'px'}">
      <textarea id="import-result" readonly data-bind="value: importResult().text"></textarea>
    </div>
  </div>
  <div data-bind="if: confirmPopup()">
    <div id="confirm-background">
      <div id="confirm-dialog">
        <h1>Import</h1>
        <p>You are about to modify your data in Salesforce. This action cannot be undone.</p>
        <p data-bind="text: confirmPopup().text"></p>
        <div class="dialog-buttons">
          <button data-bind="click: confirmPopupYes">Import</button>
          <button data-bind="click: confirmPopupNo">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  <script src="knockout-3.2.0.js"></script>
  <script src="chromePopup.js"></script>
  <script src="dataImport.js"></script>
</body>
</html>